<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
  </head>
  <script>
    let canvas;
    let canvasContext;
    let ballX = 0;
    let ballY = 0;
    let ballSpeedX = 10;
    let ballSpeedY = 5;
    let ballRadius = 10;

    const PADDLE_WIDTH = 10;
    const PADDLE_HEIGHT = 100;
    let paddle1Y = 250;
    let paddle1Pos = { top: paddle1Y, bottom: paddle1Y + PADDLE_HEIGHT };
    let paddle1

    document.addEventListener('DOMContentLoaded', function() {
      canvas = document.getElementById("gameCanvas");
      canvasContext = canvas.getContext('2d');

      let fps = 30;
      setInterval(callBoth, 1000/fps);
    });

    document.addEventListener('mousemove', function(e) {
      let mousePos = calculateMousePos(e);
      paddle1Y = mousePos.y - (PADDLE_HEIGHT/2);

      paddle1Pos = calculatePaddlePos(e);
    });

    function calculatePaddlePos(event) {
      let mousePos = calculateMousePos(event);
      let result = {
        top: mousePos.y - PADDLE_HEIGHT/2,
        bottom: mousePos.y + PADDLE_HEIGHT/2
      };

      return result;
    }

    function resetBall() {
      ballX = (canvas.width - ballRadius)/2;
      ballY = (canvas.height - ballRadius)/2;
    }

    function calculateMousePos(event) {
      let rect = canvas.getBoundingClientRect();
      let root = document.documentElement;
      let mouseX = event.clientX - rect.left - root.scrollLeft;
      let mouseY = event.clientY - rect.top - root.scrollTop;
      let result = {
        x: mouseX,
        y: mouseY
      };

      // console.log(result);

      return result;
    }
    function callBoth() {
      moveEverything();
      drawEverything();
    }

    function moveEverything() {
      ballX += ballSpeedX;
      ballY += ballSpeedY;

      if (ballX > canvas.width) {
        ballX -= ballSpeedX;
        ballSpeedX = -ballSpeedX;
      }

      if (ballX < 0) {
        if (!(paddle1Pos.top < ballY && paddle1Pos.bottom > ballY)) {
          resetBall();
        }

        ballX += -ballSpeedX;
        ballSpeedX = -ballSpeedX;
      }

      if (ballY > canvas.height) {
        ballY -= ballSpeedY;
        ballSpeedY = -ballSpeedY;
      }

      if (ballY < 0) {
        ballY += -ballSpeedY;
        ballSpeedY = -ballSpeedY;
      }
    }

    function colorRect(x, y, width, height, color) {
      canvasContext.fillStyle = color;
      canvasContext.fillRect(x, y, width, height);
    }

    function colorCircle(x, y, radius, color) {
      canvasContext.fillStyle = color;
      canvasContext.beginPath();
      canvasContext.arc(x, y, radius, 0, Math.PI*2, true);
      canvasContext.fill();
    }

    function drawEverything() {
      colorRect(0, 0, canvas.width, canvas.height, 'black');
      colorRect(0, paddle1Y, PADDLE_WIDTH, PADDLE_HEIGHT, 'white');
      colorCircle(ballX, ballY, ballRadius, 'white');
    }
  </script>

  <body>
    <canvas id='gameCanvas' width='800' height='600'></canvas>
  </body>
</html>
